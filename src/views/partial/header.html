<div class="md:fixed md:top-0 w-full md:backdrop-blur-xl md:z-50 mb-20"
  x-data="{
    menuOpen: false,
    isToken: false,
    base64Image: '',
    isProfileMenuOpen: false,
    platform: '',
    deviceInfo: { isMobile: false, platform: '', browser: '' },
    
    init() {
      this.detectDevice();
      this.checkAuth();
    },
    
    checkAuth() {
      const token = localStorage.getItem('token');
      const userData = localStorage.getItem('user');

      this.isToken = !!token;
      if (userData) {
        const parsedData = JSON.parse(userData);
        this.base64Image = parsedData.picture ? 'data:image/png;base64,' + parsedData.picture : '';
      }
    },
    
    handleLogout() {
      localStorage.removeItem('token');
      localStorage.removeItem('uid');
      localStorage.removeItem('islogin');
      localStorage.removeItem('user');
      this.isToken = false;
      window.location.href = '/';
    },
    
    detectDevice() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      this.deviceInfo = {
        isMobile: /iPhone|iPad|iPod|Android/.test(userAgent),
        platform: /Windows/.test(userAgent) ? 'windows' :
                  /Mac/.test(userAgent) ? 'mac' :
                  /iPhone|iPad|iPod/.test(userAgent) ? 'ios' :
                  /Android/.test(userAgent) ? 'android' : '',
        browser: /Chrome/.test(userAgent) ? 'Chrome' :
                 /Safari/.test(userAgent) ? 'Safari' : 'Unknown'
      };
      this.platform = this.deviceInfo.platform;
    }
  }"
  x-init="init()"
  @click.away="isProfileMenuOpen = false"
>

<header class="flex items-center w-full justify-between px-6 lg:px-10 py-2">
  <a href="/" class="block">
    <img src="/images/logo.webp" class="w-[120px] md:w-[120px] sm:w-[150px] lg:w-[160px]" alt="logo">
  </a>

  {# Desktop Navigation #}
  <nav class="hidden mt-3 md:flex space-x-4 lg:space-x-6">
    <a href="/" :class="window.location.pathname === '/' ? 'text-white' : 'text-[#938FAA]'">Home</a>
    <a :href="`/download/${platform}`"
      :class="window.location.pathname.startsWith('/download') ? 'text-white' : 'text-[#938FAA]'">Download</a>
    <a href="/mt-token"
      :class="window.location.pathname === '/mt-token' ? 'text-white' : 'text-[#938FAA]'">MT Token</a>
    <a href="/pricing"
      :class="window.location.pathname === '/pricing' ? 'text-white' : 'text-[#938FAA]'">Pricing</a>
  </nav>

  {# User Authentication Section #}
  <div class="flex items-center">
    <template x-if="isToken">
      <div class="flex">
        <img :src="base64Image || '/images/profile-image.png'" class="w-9 h-9 object-cover" alt="Profile">
        <button @click="isProfileMenuOpen = !isProfileMenuOpen" class="p-1 hover:bg-gray-800 rounded-full">
          <svg width="28px" height="28px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.75a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5zm0 14a1.75 1.75 0 1 0 0-3.5 1.75 1.75 0 0 0 0 3.5zM13.75 12a1.75 1.75 0 1 1-3.5 0 1.75 1.75 0 0 1 3.5 0z" fill="#938FAA"></path></g></svg>
        </button>

        {# Profile Dropdown Menu #}
        <div x-show="isProfileMenuOpen" @click.away="isProfileMenuOpen = false"
          class="absolute right-0 mt-10 w-48 bg-[#0A0419] rounded-lg shadow-lg border border-gray-800 z-50">
          <a href="/dashboard" class="flex items-center px-4 py-2 text-[#938FAA] hover:bg-gray-800">
            <img src="/images/user-icon.svg" class="w-5 h-5 mr-2"> Dashboard
          </a>
          <a href="/dashboard/account-settings" class="flex items-center px-4 py-2 text-[#938FAA] hover:bg-gray-800">
            <img src="/images/setting-icon.svg" class="w-5 h-5 mr-2"> Account Settings
          </a>
          <button @click="handleLogout" class="flex items-center w-full px-4 py-2 text-[#938FAA] hover:bg-gray-800">
            <img src="/images/log-out-icon.svg" class="w-5 h-5 mr-2"> Log Out
          </button>
        </div>
      </div>
    </template>

    <template x-if="!isToken">
      <a href="/signin"
        class="inline-flex items-center font-semibold text-base w-max border border-[#71EE9E] text-[#71EE9E] rounded-xl px-4 py-2">
        Login
      </a>
    </template>
  </div>
</header>

{# Mobile Menu #}
<div x-show="menuOpen"
  class="md:hidden relative mx-auto rounded-b-lg top-24 left-0 w-[90%] border-x-2 border-b-2 px-3 border-[#938FAA] bg-[#05030e] z-30"
  :class="menuOpen ? 'translate-y-0' : '-translate-y-56 opacity-0 pointer-events-none'">
  {# Mobile menu content #}
</div>
</div>
